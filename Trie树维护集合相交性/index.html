<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Trie树维护集合相交性 | Wilson&#39;s blog</title>
  <link rel="stylesheet" href="/css/fonts/Chinese-normal-normal.min.css">
  <link rel="stylesheet" href="/css/fonts/ChineseMono-normal-normal.min.css">
  <link rel="stylesheet" href="/css/fonts/Chinese-italic-normal.min.css">
  <link rel="stylesheet" href="/css/fonts/Chinese-normal-bold.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="这篇文章讲一个 trick，他可以解决如下问题：

维护一个结构，可以添加和删除集合，可以询问：对询问中给定的新集合，结构中有多少集合与之不交？

用这个 trick，可以在 $O(2^{|S|})$ 的时间复杂度内添加或询问一个集合 $S$ ，所以在多个小集合的时候比较有用。
对两个集合 $A$ ">
  
  
    <link rel="alternate" href="../atom.xml" title="Wilson's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="../favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox-1.3.4.css">
  
  
    <link rel="stylesheet" href="/katex/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">

    <!-- The loading of KaTeX is deferred to speed up page rendering -->
    <script defer src="/katex/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>

    <!-- To automatically render math in text elements, include the auto-render extension: -->
    <script defer src="/katex/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false},
            {left: '\\[', right: '\\]', display: true}
          ],
          throwOnError : false
        });
      });
    </script>
  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <div id="nav-outer">
  <nav id="main-nav" class="outer">
    <a id="main-nav-toggle" class="nav-icon"></a>
    
      <a class="main-nav-link" href="../index.html">Home</a>
    
      <a class="main-nav-link" href="../archives">Archives</a>
    
      <a class="main-nav-link" href="../about">About</a>
    
    <div class="main-nav-space-between"></div>
    
      <a id="nav-rss-link" class="nav-icon" href="../atom.xml" title="RSS 订阅"></a>
    
  </nav>
</div>
<div id="header-title">
  <h1 id="logo-wrap">
    <a href="../index.html" id="logo">Wilson&#39;s blog</a>
  </h1>
  
</div>

      <div id="content" class="outer">
        <section id="main"><article id="post-Trie树维护集合相交性" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="" class="article-date">
  <time class="dt-published" datetime="2022-03-03T09:40:59.181Z" itemprop="datePublished">2022-03-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/">奇技淫巧</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Trie树维护集合相交性
    </h1>
  

      </header>
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>这篇文章讲一个 trick<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>他可以解决如下问题<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<blockquote>
<p>维护一个结构<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以添加和删除集合<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以询问<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>对询问中给定的新集合<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>结构中有多少集合与之不交<span class="bd-box"><h-char class="bd bd-beg"><h-inner>？</h-inner></h-char></span></p>
</blockquote>
<p>用这个 trick<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以在 <span class="markdown-them-math-inline">$O(2^{|S|})$</span> 的时间复杂度内添加或询问一个集合 <span class="markdown-them-math-inline">$S$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>所以在多个小集合的时候比较有用<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>对两个集合 <span class="markdown-them-math-inline">$A$</span> 和 <span class="markdown-them-math-inline">$B$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>考虑 <span class="markdown-them-math-inline">$B$</span> 的所有子集<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>维护一个计数器 <span class="markdown-them-math-inline">$cnt$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>对每个子集 <span class="markdown-them-math-inline">$S$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>如果它也是 <span class="markdown-them-math-inline">$A$</span> 的子集<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>为 <span class="markdown-them-math-inline">$cnt$</span> 加上 <span class="markdown-them-math-inline">$(-1)^{|S|}$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<div class="markdown-them-math-block">$$cnt=\sum_{S\subset (A\cap B)}(-1)^{|S|}=\sum_{i=0}^{|S|}\binom{|S|}{i}(-1)^i\times 1^{|S|-i}=(1-1)^{|S|}
$$</div><p><span class="markdown-them-math-inline">$A\cap B=\emptyset$</span> 时形式上是<span class="markdown-them-math-inline">$0^0$</span>不定式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>根据定义式计算<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>发现它有由空集贡献的 1 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>于是 <span class="markdown-them-math-inline">$cnt$</span> 就标志着 <span class="markdown-them-math-inline">$A\cap B$</span> 是否为空<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>为空时 <span class="markdown-them-math-inline">$cnt=1$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>否则 <span class="markdown-them-math-inline">$cnt=0$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>现在我们维护一个 Trie 树<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>每个节点代表一个集合<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>当添加集合 <span class="markdown-them-math-inline">$A$</span> 时<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>给它的所有子集对应的节点权值加一<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>删除时<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>就为所有子集对应的节点权值减一<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>可以注意到空集对应节点的权值就代表当前结构中维护的集合个数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>然后考虑询问<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>设在询问 <span class="markdown-them-math-inline">$S$</span> <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>对所有 <span class="markdown-them-math-inline">$S'\subset S$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>如果 Trie 树中有对应 <span class="markdown-them-math-inline">$S'$</span> 的节点<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>就为计数器加上 <span class="markdown-them-math-inline">$(-1)^{|S'|}\times tr ie[S']$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>这样<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>对结构中维护的每个集合<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>若它和 <span class="markdown-them-math-inline">$S$</span> 不交<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>它对计数器的贡献就是 1 <span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>否则是 0<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>于是计数器的值就代表了结构中与 <span class="markdown-them-math-inline">$S$</span> 不交的集合个数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>

      
    </div>
    <footer class="article-footer">
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../CF-Edu123-%E9%A2%98%E8%A7%A3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          CF Edu123 题解
        
      </div>
    </a>
  
  
    <a href="../ARC136%E9%A2%98%E8%A7%A3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          ARC136题解
        
      </div>
    </a>
  
</nav>

  
</article>


</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
        &copy; 2022 Wilson Xia<br>
Powered by <a href="https://hexo.io/" target="_blank">Hexo</a><br>
      
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="../js/clipboard.min.js"></script>
<script src="../js/jquery-1.4.3.min.js"></script>

<script src="../fancybox/jquery.fancybox-1.3.4.pack.js"></script>


<script src="../js/script.js"></script>






  </div>
</body>
</html>