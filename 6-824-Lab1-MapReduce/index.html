<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>6.824 Lab1 MapReduce | Wilson&#39;s blog</title>
  <link rel="stylesheet" href="https://fonts.wilsonxia.cn/Chinese-normal-normal.min.css">
  <link rel="stylesheet" href="https://fonts.wilsonxia.cn/ChineseMono-normal-normal.min.css">
  <link rel="stylesheet" href="https://fonts.wilsonxia.cn/Chinese-italic-normal.min.css">
  <link rel="stylesheet" href="https://fonts.wilsonxia.cn/Chinese-normal-bold.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="前前后后做了15个小时，看到PASSED ALL 30 TESTING TRIALS的那一刻，太爽！
概述
这个实验要求实现经典论文MapReduce的模型。MapReduce在Google内部是跑在一个服务器集群里的，这些服务器共享一个分布式文件系统GFS。这个实验只要求实现运行在本机多个进程上的">
  
  
    <link rel="alternate" href="../atom.xml" title="Wilson's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="../favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox-1.3.4.css">
  
<meta name="generator" content="Hexo 6.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <div id="nav-outer">
  <nav id="main-nav" class="outer">
    <a id="main-nav-toggle" class="nav-icon"></a>
    
      <a class="main-nav-link" href="../index.html">Home</a>
    
      <a class="main-nav-link" href="../archives">Archives</a>
    
      <a class="main-nav-link" href="../about">About</a>
    
    <div class="main-nav-space-between"></div>
    
      <a id="nav-rss-link" class="nav-icon" href="../atom.xml" title="RSS 订阅"></a>
    
  </nav>
</div>
<div id="header-title">
  <h1 id="logo-wrap">
    <a href="../index.html" id="logo">Wilson&#39;s blog</a>
  </h1>
  
</div>

      <div id="content" class="outer">
        <section id="main"><article id="post-6-824-Lab1-MapReduce" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="" class="article-date">
  <time class="dt-published" datetime="2022-03-19T16:01:19.000Z" itemprop="datePublished">2022-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      6.824 Lab1 MapReduce
    </h1>
  

      </header>
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>前前后后做了15个小时<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>看到<code>PASSED ALL 30 TESTING TRIALS</code>的那一刻<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>太爽<span class="bd-box"><h-char class="bd bd-beg"><h-inner>！</h-inner></h-char></span></p>
<h2 id="概述">概述</h2>
<p>这个实验要求实现经典论文MapReduce的模型<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>MapReduce在Google内部是跑在一个服务器集群里的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>这些服务器共享一个分布式文件系统GFS<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>这个实验只要求实现运行在本机多个进程上的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>、</h-inner></h-char></span>本地文件系统上的MapReduce模型<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>省去了与分布式文件系统的交互<span class="bd-box"><h-char class="bd bd-end"><h-inner>（</h-inner></h-char></span>要做负载均衡这个很重要<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>而且应该很麻烦<span class="bd-box"><h-char class="bd bd-beg"><h-inner>）</h-inner></h-char><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h2 id="实现过程流水账">实现过程流水账</h2>
<p>先读论文花了3h左右<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>内心活动<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>这论文真简单<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>然后开始实现<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>我并不会go语言<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>官网那个tour我也就做了一点点<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>事实证明全做完比较省时间<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>第一次写的代码全是<code>if-else</code><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我还没有加入容错机制的时候代码已经复杂到我读不懂了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>内心活动<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>工业界实现这玩意的人是神仙吧<span class="bd-box"><h-char class="bd bd-beg"><h-inner>！</h-inner></h-char></span>然后我把3个小时码的200多行代码全都回滚掉了:-(</p>
<p>第二次写代码之前<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我决定写一个类似于有限状态自动机的东西<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>事实证明这个模型还不错<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>让我的思路变得比较清晰<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>并且便于拓展<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>然后花了2h画图+搭框架<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>就是只写了一堆<code>switch-case</code><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>每种状态对应的转移和转移前需要进行的操作<em>的注释</em><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>然后就头晕<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>下班了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>今天是第三次碰这个东西<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>今天如果再自闭我可能就要对这实验产生心理阴影了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>好在我上次的DFA没啥大问题<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>只是有些corner case没想到<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>缝缝补补搞了一段时间<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>终于把注释转换成了代码<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>最戏剧性的一刻来了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>开码10小时后我终于进行了第一次编译<span class="bd-box"><h-char class="bd bd-beg"><h-inner>！</h-inner></h-char></span>我以为会得到巨长无比的报错<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>结果报错就八九行<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>然后就是改完一行错再出现一行错<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>改完<span class="bd-box"><h-char class="bd bd-end"><h-inner>“</h-inner></h-char></span>最后一行<span class="bd-box"><h-char class="bd bd-beg"><h-inner>”</h-inner></h-char></span>错之后又蹦出来十几个错误<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>改了若干年……通过编译之后<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>他在起始状态就出错了……然后又改了若干年<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>终于输出了结果<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<blockquote>
<p>第一个教训<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>把语言学明白<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>勤编译勤测试<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</blockquote>
<p>我查看输出文件的前三行<span class="bd-box"><h-char class="bd bd-end"><h-inner>（</h-inner></h-char></span>共两万行<span class="bd-box"><h-char class="bd bd-beg"><h-inner>）</h-inner></h-char><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>发现与标准输出一样<span class="bd-box"><h-char class="bd bd-beg"><h-inner>！</h-inner></h-char></span>然后高兴地去跑测试脚本<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>结果第一个正确性测试点就挂了……</p>
<blockquote>
<p>第二个教训<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>测试要认真严谨<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</blockquote>
<p>然后又改了若干年<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>期间多次翻阅论文<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>发现人家写进论文的东西都是经过取舍和迭代的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>还是非常精华的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>后来就是无限改bug<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>调试<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>按下不表<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>终于在今天码代码的第8小时通过了所有测试<span class="bd-box"><h-char class="bd bd-beg"><h-inner>！</h-inner></h-char></span></p>
<h3 id="做的不错的地方">做的不错的地方</h3>
<ol>
<li>画DFA</li>
<li>头脑不清楚的时候出门转转<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>可以花掉长达20分钟的时间<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>但是回来之后你就复活了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>！</h-inner></h-char></span></li>
</ol>
<h3 id="想要做得更好的地方">想要做得更好的地方</h3>
<ol>
<li>阶段性编译<span class="bd-box"><h-char class="bd bd-beg"><h-inner>、</h-inner></h-char></span>测试<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>例如我的DFA设计好了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>这时候就可以测试下转移有没有问题<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>然后再在转移前后加功能<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></li>
<li>有设计测试点的能力<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>对于这个实验<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我是用户<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>而且一定程度上可以说是赶时间<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>所以用老师的脚本来测试<span class="bd-box"><h-char class="bd bd-beg"><h-inner>、</h-inner></h-char></span>调试没有什么错<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>但是一旦成为真正意义上的开发者<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>bug都要自己找<span class="bd-box"><h-char class="bd bd-end"><h-inner>（</h-inner></h-char></span>不提开源社区之类<span class="bd-box"><h-char class="bd bd-beg"><h-inner>）</h-inner></h-char><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>需要有能力设计若干测试来检验自己的代码在各方面的正确性/性能<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>这确实需要写一些<span class="bd-box"><h-char class="bd bd-end"><h-inner>“</h-inner></h-char></span>没用的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>”</h-inner></h-char></span>代码<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>但是它们通常很简单<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>而且很有用<span class="bd-box"><h-char class="bd bd-end"><h-inner>（</h-inner></h-char></span>如算法竞赛里的对拍程序和暴力程序<span class="bd-box"><h-char class="bd bd-beg"><h-inner>）</h-inner></h-char><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>例如<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我尽管知道各个操作的时间/空间复杂度<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>但还是不知道我这个实现并发性如何<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>究竟有多少CPU时间是overhead<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></li>
<li>证明我的DFA的正确性</li>
<li>Challenge</li>
<li>阅读老师的测试脚本<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>学习写脚本</li>
</ol>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/distributed-system/" rel="tag">distributed system</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/lab/" rel="tag">lab</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/system/" rel="tag">system</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../%E5%A4%8D%E8%AF%BB%E5%A4%A7%E4%B8%89/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          复读大三
        
      </div>
    </a>
  
  
    <a href="../CF-Edu123-%E9%A2%98%E8%A7%A3/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          CF Edu123 题解
        
      </div>
    </a>
  
</nav>

  
</article>


</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
        &copy; 2022 Wilson Xia<br>
Powered by <a href="https://hexo.io/" target="_blank">Hexo</a><br>
      
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="../js/clipboard.min.js"></script>
<script src="../js/jquery-1.4.3.min.js"></script>

<script src="../fancybox/jquery.fancybox-1.3.4.pack.js"></script>


<script src="../js/script.js"></script>








<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" integrity="sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
      delimiters: [
        {left: '$$', right: '$$', display: true},
        {left: '$', right: '$', display: false},
        {left: '\\(', right: '\\)', display: false},
        {left: '\\[', right: '\\]', display: true}
      ],
      throwOnError : false
    });
  });
</script>

  </div>
</body>
</html>